-- 1. Create Tables
CREATE TABLE Borrower(
    Rollno NUMBER,
    Name VARCHAR2(20),
    DateofIssue DATE,
    NameofBook VARCHAR2(30),
    Status VARCHAR2(10)
);

CREATE TABLE Fine(
    Rollno NUMBER,
    DateIssued DATE,
    Amount NUMBER
);

-- 2. Insert Data
INSERT INTO Borrower VALUES(14,'Ram',DATE '2022-09-19','Operating System','I');
INSERT INTO Borrower VALUES(27,'Soham',DATE '2022-07-24','Object Oriented Programming','I');
INSERT INTO Borrower VALUES(34,'Mohan',DATE '2022-06-12','Microprocessor','I');
INSERT INTO Borrower VALUES(48,'Om',DATE '2022-04-19','Mechanics','I');

COMMIT;

-- 3. Procedure to Calculate Fine
CREATE OR REPLACE PROCEDURE calc_Fine(
    r IN NUMBER,
    b IN VARCHAR2
)
IS
    doi DATE;
    diff NUMBER;
    amt NUMBER;
BEGIN
    -- Get Date of Issue
    SELECT DateofIssue INTO doi
    FROM Borrower
    WHERE Rollno = r AND NameofBook = b;

    -- Calculate difference in days
    diff := TRUNC(SYSDATE - doi);

    -- Determine fine
    IF diff >= 15 AND diff <= 30 THEN
        amt := diff * 5;
        INSERT INTO Fine(Rollno, DateIssued, Amount) VALUES(r, SYSDATE, amt);
    ELSIF diff > 30 THEN
        amt := diff * 50;
        INSERT INTO Fine(Rollno, DateIssued, Amount) VALUES(r, SYSDATE, amt);
    END IF;

    COMMIT;
END;
/

-- 4. Procedure to Submit Book
CREATE OR REPLACE PROCEDURE submit(
    r IN NUMBER
)
IS
BEGIN
    UPDATE Borrower SET Status = 'R' WHERE Rollno = r;
    DELETE FROM Fine WHERE Rollno = r;
    COMMIT;
END;
/

-- 5. Call Procedures
BEGIN
    calc_Fine(14,'Operating System');
    calc_Fine(27,'Object Oriented Programming');
    calc_Fine(34,'Microprocessor');
    calc_Fine(48,'Mechanics');
END;
/

-- 6. View Fine Table
SELECT * FROM Fine;

-- 7. Submit Books
BEGIN
    submit(14);
    submit(27);
    submit(34);
    submit(48);
END;
/

-- 8. View Tables After Submission
SELECT * FROM Borrower;
SELECT * FROM Fine;

--(link : https://github.com/adityasurya4103/SPPU-COMP-TE-PRACTICALS-LP1-AND-DBMS/blob/main/DBMS/Basic%20PL_SQL   )
